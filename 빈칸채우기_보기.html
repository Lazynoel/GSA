<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grammar Diagnostic Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .word-box, .sentence {
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .word {
            margin: 5px;
            padding: 5px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            display: inline-block;
        }
        .blank {
            display: inline-block;
            width: 100px;
            height: 20px;
            margin: 5px;
            padding: 5px;
            background-color: #fff;
            border: 1px dashed #aaa;
            vertical-align: middle;
        }
        .highlight {
            border-color: #f90;
            background-color: #ffc;
        }
        .hovered {
            background-color: #e0e0e0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Word Choices</h2>
    <div id="wordChoices" class="word-box">
        <!-- Dynamically filled with JavaScript -->
    </div>

    <h2>Fill in the Blanks</h2>
    <div id="sentences">
        <!-- Dynamically filled with JavaScript -->
    </div>

    <button id="checkAnswers">Check Answers</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script>
    // Sample data for the test
    const words = ["meticulously", "concisely", "preliminary", "altogether", "transaction", "specify", "exempt", "authorization", "ingredient", "approximately"];
    const sentences = [
        { text: "He worked ___ on his project to ensure it was perfect.", answer: "meticulously" },
        { text: "The professor explained the topic ___.", answer: "concisely" },
        { text: "Before the main study, we conducted ___ research.", answer: "preliminary" },
        { text: "Due to unforeseen circumstances, the project was cancelled ___.", answer: "altogether" },
        { text: "The ___ between the two companies was finalized yesterday.", answer: "transaction" },
        { text: "It's important to ___ the requirements before proceeding.", answer: "specify" },
        { text: "Certain products are ___ from the sales tax.", answer: "exempt" },
        { text: "Accessing the secure area requires special ___.", answer: "authorization" },
        { text: "Flour is a basic ___ in bread making.", answer: "ingredient" },
        { text: "The journey should take ___ two hours by train.", answer: "approximately" }
    ];

    $(function() {
        // Populate words
        words.forEach(word => {
            $('#wordChoices').append(`<div class="word">${word}</div>`);
        });

        // Populate sentences with blanks and number them
        sentences.forEach((sentence, index) => {
            $('#sentences').append(`<div class="sentence">${index + 1}. ${sentence.text.replace('___', `<div class="blank" data-answer="${sentence.answer}" data-index="${index}"></div>`)}</div>`);
        });

        makeWordsDraggable();
        makeBlanksDroppable();

        $('#checkAnswers').on('click', function() {
            let score = 0; // Initialize score
            $('.blank').each(function() {
                const userAnswer = $(this).text().trim();
                const correctAnswer = $(this).data('answer');
                if (userAnswer === correctAnswer) {
                    $(this).css('background-color', 'lightgreen');
                    score++; // Increment score for correct answer
                } else {
                    $(this).css('background-color', 'salmon');
                }
            });
            alert(`Your score is ${score} out of 10`); // Display score in a popup
        });
    });

    function makeWordsDraggable() {
        $(".word").draggable({
            helper: "clone",
            revert: "invalid"
        });
    }

    function makeBlanksDroppable() {
        $(".blank").droppable({
            accept: ".word",
            classes: {
                "ui-droppable-active": "highlight",
                "ui-droppable-hover": "hovered"
            },
            drop: function(event, ui) {
                $(this).text(ui.draggable.text()).removeClass("highlight hovered");
            }
        });
    }
    function saveScoreToDrive(accessToken, scoreData) {
    const boundary = '-------314159265358979323846';
    const delimiter = "\r\n--" + boundary + "\r\n";
    const closeDelim = "\r\n--" + boundary + "--";

    var fileContent = JSON.stringify(scoreData); // Assuming scoreData is an object
    var metadata = {
        'name': 'scoreData.json',
        'mimeType': 'application/json'
    };

    var multipartRequestBody =
        delimiter +
        'Content-Type: application/json; charset=UTF-8\r\n\r\n' +
        JSON.stringify(metadata) +
        delimiter +
        'Content-Type: application/json\r\n\r\n' +
        fileContent +
        closeDelim;

    var request = gapi.client.request({
        'path': '/upload/drive/v3/files',
        'method': 'POST',
        'params': {'uploadType': 'multipart'},
        'headers': {
            'Authorization': 'Bearer ' + accessToken,
            'Content-Type': 'multipart/related; boundary="' + boundary + '"'
        },
        'body': multipartRequestBody
    });

    request.execute(function(file) {
        console.log(file);
    });
}
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<!-- Include Touch Punch after jQuery UI -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
</body>
</html>
