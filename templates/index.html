<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GSA 영재고 Daily Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <style>
        body { font-family: "태백은하수체",Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .word-box, .sentence { padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .word { margin: 5px; padding: 5px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; cursor: pointer; display: inline-block; }
        .blank { display: inline-block; width: 100px; height: 20px; background-color: #fff; border: 2px solid #000; vertical-align: middle; text-align: center; line-height: 20px; }
        .highlight { border-color: #f90; background-color: #ffc; }
        .hovered { background-color: #e0e0e0; }
        h1 { text-align: center; font-weight: bold; font-size: 35px; }
        h2 { text-align: right;font-size: 20px; } 
        h3 { text-align: center; font-weight: bold; font-size: 25px; }
        .name-input-container { text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h1>Daily QUIZ</h1>
    <h2>Enter Your Name</h2>
    <div class="name-input-container"> <!-- Add custom class to align input container -->
        <input type="text" id="name" placeholder="Your Name">
    </div>
    
    <h3>Word Choices</h3>
    <div id="wordChoices" class="word-box"></div>

    <h3>Fill in the Blanks</h3>
    <div id="sentences"></div>

    <button id="checkAnswers">Check Answers</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<!-- Include jQuery UI Touch Punch for mobile compatibility after jQuery UI -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<script>
    <script>
    $(function() {
        fetch('/get-quiz')
        .then(response => response.json())
        .then(data => {
            data.words.forEach((word, index) => {
                $('#wordChoices').append(`<div class="word" data-id="${word.id}">${word.text}</div>`);
            });

            data.sentences.forEach(sentence => {
                let sentenceHtml = sentence.text;
                sentence.blanks.forEach(blank => {
                    sentenceHtml = sentenceHtml.replace('___', `<div class="blank" data-expected-id="${blank.id}"></div>`);
                });
                $('#sentences').append(`<div class="sentence">${sentenceHtml}</div>`);
            });

            makeWordsDraggable();
            makeBlanksDroppable();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to fetch quiz data.');
        });

        function makeWordsDraggable() {
            $(".word").draggable({
                helper: "clone",
                revert: "invalid"
            });
        }

        function makeBlanksDroppable() {
            $(".blank").droppable({
                accept: ".word",
                classes: {
                    "ui-droppable-active": "highlight",
                    "ui-droppable-hover": "hovered"
                },
                drop: function(event, ui) {
                    const droppedWordId = ui.draggable.data('id');
                    const expectedWordId = $(this).data('expected-id');
                    if (droppedWordId === expectedWordId) {
                        $(this).html(ui.draggable.text()).removeClass("highlight hovered").data('answer', true);
                    } else {
                        $(this).addClass("incorrect"); // Visual cue for incorrect drop
                    }
                }
            });
        }

        $('#checkAnswers').click(function() {
            const name = $('#name').val().trim();
            if (!name) {
                alert("Please enter your name before checking answers.");
                return;
            }

            let score = $('.blank[data-answer="true"]').length; // Count correctly answered blanks
            alert(`Your score is ${score} out of ${$('.blank').length}`);
            submitScore(name, score);
        });

        function submitScore(name, score) {
            fetch('/submit-score', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name, score: score })
            })
            .then(response => response.json())
            .then(data => {
                alert('Score submitted successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to submit score.');
            });
        }
    });
</script>


</body>
</html>
